# ═══════════════════════════════════════════════════════════════════════════
# Asterisk AI Voice Agent - Environment Configuration
# ═══════════════════════════════════════════════════════════════════════════
# Copy this file to .env and configure for your environment.
# 
# IMPORTANT: This file contains SECRETS and ENVIRONMENT-SPECIFIC settings only.
# For application behavior (audio transport, pipelines, barge-in, etc.),
# edit config/ai-agent.yaml instead.

# ═══════════════════════════════════════════════════════════════════════════
# REQUIRED: Asterisk ARI Connection
# ═══════════════════════════════════════════════════════════════════════════

# ASTERISK_HOST: How ai-engine connects to Asterisk ARI
# This is environment-specific (differs between dev/staging/prod)
ASTERISK_HOST=127.0.0.1

# ARI Credentials (SECRETS - keep in .env, never commit to git)
# Create in FreePBX: Settings → Asterisk REST Interface Users
ASTERISK_ARI_USERNAME=asterisk
ASTERISK_ARI_PASSWORD=asterisk

# Asterisk User/Group IDs (for container permission alignment)
# Detect with: id -u asterisk && id -g asterisk
# Defaults to 995 (FreePBX standard) - adjust for your system
# ASTERISK_UID=995
# ASTERISK_GID=995

# ═══════════════════════════════════════════════════════════════════════════
# REQUIRED: AI Provider API Keys (SECRETS)
# ═══════════════════════════════════════════════════════════════════════════
# Get keys at:
#   OpenAI: https://platform.openai.com/api-keys
#   Deepgram: https://console.deepgram.com/
#   Google Cloud: https://console.cloud.google.com/apis/credentials

# Placeholder keys (replace with real keys from wizard or manually)
OPENAI_API_KEY=sk-proj-placeholder
DEEPGRAM_API_KEY=placeholder-key
GOOGLE_API_KEY=AIza-placeholder

# Option 2: Service Account (recommended for production)
# Create service account at: https://console.cloud.google.com/iam-admin/serviceaccounts
# Download JSON key and set the full path below
# GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json
#
# Required APIs to enable:
#   - Cloud Speech-to-Text API (for STT)
#   - Cloud Text-to-Speech API (for TTS)
#   - Generative Language API (for Gemini LLM)
#   - Gemini Live API (for google_live real-time agent)
#
# IAM Roles needed:
#   - roles/speech.client (for STT)
#   - roles/texttospeech.client (for TTS)
#   - roles/generativelanguage.user (for Gemini LLM)
#   - roles/generativelanguage.liveapi.user (for Gemini Live API)
#
# For Google Live API (google_live provider):
#   - Use GOOGLE_API_KEY for direct API access
#   - Or GOOGLE_APPLICATION_CREDENTIALS for service account
#   - Live API enables real-time bidirectional streaming with barge-in

# ═══════════════════════════════════════════════════════════════════════════
# AI Assistant Configuration (User Preferences)
# ═══════════════════════════════════════════════════════════════════════════

GREETING="Hello, how can I help you today?"
AI_ROLE="You are a concise and helpful voice assistant."

# ═══════════════════════════════════════════════════════════════════════════
# AI Engine Logging Configuration (Environment-Specific)
# ═══════════════════════════════════════════════════════════════════════════
# These settings control logging for the main ai-engine container
# Adjust these per environment (dev=debug, prod=info)

LOG_LEVEL=info               # AI Engine: debug|info|warning|error|critical
LOG_FORMAT=console           # AI Engine: console (colored) | json (for log aggregation)
LOG_COLOR=1                  # AI Engine: console only: 1=colored, 0=plain
LOG_SHOW_TRACEBACKS=auto     # AI Engine: auto|always|never
STREAMING_LOG_LEVEL=info     # AI Engine: Audio pipeline logging verbosity

# Optional: File logging (Docker logs usually sufficient)
# LOG_TO_FILE=0
# LOG_FILE_PATH=/mnt/asterisk_media/ai-engine.log

# ═══════════════════════════════════════════════════════════════════════════
# Local AI Server Connection (Optional - for local_hybrid pipeline)
# ═══════════════════════════════════════════════════════════════════════════
# Only used if you enable local_hybrid pipeline in ai-agent.yaml

LOCAL_WS_URL=ws://127.0.0.1:8765
LOCAL_WS_CONNECT_TIMEOUT=2.0
LOCAL_WS_RESPONSE_TIMEOUT=5.0
LOCAL_WS_CHUNK_MS=320

# ───────────────────────────────────────────────────────────────────────────
# Local AI Server Logging (local-ai-server container only)
# ───────────────────────────────────────────────────────────────────────────
# These settings control logging for the local-ai-server container
# Only applies when using local_hybrid or local_only pipelines

LOCAL_LOG_LEVEL=INFO          # Local AI Server: DEBUG|INFO|WARNING|ERROR (default: INFO)
LOCAL_DEBUG=0                 # Local AI Server: 1=Enable verbose audio flow logs
                              # (FEEDING VOSK, RMS calculation, audio routing, etc.)
                              # WARNING: Only enable for troubleshooting - creates high log volume
                              # Production: Keep at 0 for clean logs

# Note: Local model paths and performance tuning are set by install.sh
# and stored in .env during installation. Don't set these manually:
# LOCAL_LLM_MODEL_PATH, LOCAL_STT_MODEL_PATH, LOCAL_TTS_MODEL_PATH,
# LOCAL_LLM_THREADS, LOCAL_LLM_CONTEXT, etc.

# ═══════════════════════════════════════════════════════════════════════════
# OPTIONAL: Monitoring & Email (SECRETS)
# ═══════════════════════════════════════════════════════════════════════════
# Get API key at https://resend.com
# Configure email recipients in config/ai-agent.yaml under monitoring.email

RESEND_API_KEY=re_placeholder

# ═══════════════════════════════════════════════════════════════════════════
# OPTIONAL: Health Endpoint (Environment-Specific)
# ═══════════════════════════════════════════════════════════════════════════
# For external monitoring tools (Prometheus, etc.)

# HEALTH_BIND_HOST=127.0.0.1  # Use 0.0.0.0 for remote monitoring
# HEALTH_BIND_PORT=15000

# ═══════════════════════════════════════════════════════════════════════════
# DIAGNOSTIC: Audio Debugging (Troubleshooting Only)
# ═══════════════════════════════════════════════════════════════════════════
# DO NOT enable in production - creates WAV file taps for analysis
# See docs/TROUBLESHOOTING.md for usage

DIAG_ENABLE_TAPS=false
# DIAG_TAP_PRE_SECS=1
# DIAG_TAP_POST_SECS=1
# DIAG_TAP_OUTPUT_DIR=/tmp/ai-engine-taps
# DIAG_EGRESS_SWAP_MODE=none
# DIAG_EGRESS_FORCE_MULAW=false
# DIAG_ATTACK_MS=0

# ═══════════════════════════════════════════════════════════════════════════
# For Application Behavior Configuration, edit config/ai-agent.yaml:
# ═══════════════════════════════════════════════════════════════════════════
# ✅ Audio transport mode (audiosocket vs externalmedia)
# ✅ Downstream playback mode (stream vs file)
# ✅ Pipelines and providers
# ✅ Barge-in settings
# ✅ VAD configuration
# ✅ AudioSocket/ExternalMedia settings
#
# Advanced environment overrides (optional):
# - AUDIO_TRANSPORT           # Override audio_transport from YAML
# - DOWNSTREAM_MODE           # Override downstream_mode from YAML
# - AUDIOSOCKET_HOST          # Override audiosocket.host
# - AUDIOSOCKET_PORT          # Override audiosocket.port
# - AUDIOSOCKET_FORMAT        # Override audiosocket.format
# - EXTERNAL_MEDIA_RTP_HOST   # Override external_media.rtp_host
# - AST_MEDIA_DIR             # Override fallback media directory for generated audio
#
# Restart after changing .env: docker-compose down && docker-compose up -d
# Restart after changing YAML: docker-compose restart ai-engine
