# ═══════════════════════════════════════════════════════════════════════════
# Asterisk ARI Connection (Required)
# ═══════════════════════════════════════════════════════════════════════════
# Copy this file to .env and set real values for your system.

# ASTERISK_HOST: IP address or hostname of the Asterisk server
# - Use 127.0.0.1 if ai-engine and Asterisk are on the SAME host (default)
# - Use remote IP/hostname if Asterisk is on a DIFFERENT host or container
# Examples:
#   ASTERISK_HOST=127.0.0.1                 # Co-located (same host)
#   ASTERISK_HOST=192.168.1.100             # Remote by IP
#   ASTERISK_HOST=asterisk.example.com      # Remote by hostname
#   ASTERISK_HOST=asterisk-container        # Docker container name (same network)
ASTERISK_HOST=127.0.0.1

# ASTERISK_ARI_USERNAME and ASTERISK_ARI_PASSWORD:
# Create a non-readonly ARI user in FreePBX (Settings → Asterisk REST Interface Users)
# These credentials MUST match what you configured in FreePBX
ASTERISK_ARI_USERNAME=asterisk
ASTERISK_ARI_PASSWORD=asterisk

# Cloud provider credentials (set what you use)
OPENAI_API_KEY=
DEEPGRAM_API_KEY=
# GOOGLE_API_KEY=

# Logging (ai-engine)
# Default: JSON output for aggregators. Set LOG_FORMAT=console for colored human-readable output.
LOG_FORMAT=console      # json|console
LOG_LEVEL=info       # debug|info|warning|error|critical
LOG_COLOR=1          # console only: 1=colored, 0=plain
# Tracebacks policy: auto=only at LOG_LEVEL=debug, always=always include, never=suppress
LOG_SHOW_TRACEBACKS=auto
# LOG_TO_FILE=0      # set to 1 to also write logs to a file
# LOG_FILE_PATH=/mnt/asterisk_media/ai-engine.log  # used when LOG_TO_FILE=1

# StreamingPlaybackManager verbosity is controlled by STREAMING_LOG_LEVEL (env var).
# Note: YAML streaming.logging_level is ignored by the config loader.

# Engine modes (recommended defaults for telephony)
# AUDIO_TRANSPORT can be: audiosocket | externalmedia
AUDIO_TRANSPORT=audiosocket
# DOWNSTREAM_MODE can be: stream | file
DOWNSTREAM_MODE=stream

# AudioSocket listener (when AUDIO_TRANSPORT=audiosocket)
AUDIOSOCKET_HOST=0.0.0.0
AUDIOSOCKET_PORT=8090
AUDIOSOCKET_FORMAT=ulaw  # ulaw | slin16

# Local AI Server (optional; used by local pipelines)
LOCAL_WS_URL=ws://127.0.0.1:8765
LOCAL_WS_CONNECT_TIMEOUT=2.0
LOCAL_WS_RESPONSE_TIMEOUT=5.0
LOCAL_WS_CHUNK_MS=320

# Local AI Server models and performance (optional overrides)
# Tip: smaller LLMs start much faster; switch to larger models for final validation.
# LOCAL_LLM_MODEL_PATH=/app/models/llm/phi-3-mini-4k-instruct.Q4_K_M.gguf   # fast startup (recommended)
# LOCAL_LLM_MODEL_PATH=/app/models/llm/llama-2-13b-chat.Q4_K_M.gguf         # large; slower cold-start
# LOCAL_STT_MODEL_PATH=/app/models/stt/vosk-model-en-us-0.22
# LOCAL_TTS_MODEL_PATH=/app/models/tts/en_US-lessac-medium.onnx
# LOCAL_LLM_THREADS=16
# LOCAL_LLM_CONTEXT=4096
# LOCAL_LLM_BATCH=256
# LOCAL_LLM_MAX_TOKENS=32
# LOCAL_LLM_TEMPERATURE=0.2
# LOCAL_LLM_USE_MLOCK=0   # set 1 to use mlock (may require privileges)
# LOCAL_STT_IDLE_MS=3000  # finalize STT after this many ms of silence

# Health endpoint (optional)
# HEALTH_HOST=0.0.0.0
# HEALTH_PORT=15000

# LLM defaults (optional)
GREETING="Hello, how can I help you today?"
AI_ROLE="You are a concise and helpful voice assistant."

# Barge-in tuning overrides (optional)
# BARGE_IN_ENABLED=true
# BARGE_IN_INITIAL_PROTECTION_MS=400
# BARGE_IN_MIN_MS=400
# BARGE_IN_ENERGY_THRESHOLD=1800
# BARGE_IN_COOLDOWN_MS=1000
# BARGE_IN_POST_TTS_END_PROTECTION_MS=250

# ============================================================================
# DIAGNOSTIC SETTINGS (For troubleshooting and RCA only)
# ============================================================================
# These settings are for debugging audio issues and root cause analysis.
# DO NOT enable in production unless actively troubleshooting.

# Streaming logger verbosity
# Values: debug | info | warning | error
# When to use: Set to 'debug' when investigating audio quality issues, pacing problems, or buffer underflows
# Production: Use 'info' or 'warning' to reduce log volume
# STREAMING_LOG_LEVEL=info
STREAMING_LOG_LEVEL=info

# PCM16 byte order detection and correction
# Values: auto | swap | none
# When to use:
#   - auto: Automatically detect and fix byte order issues (recommended for troubleshooting)
#   - swap: Force byte-swapping (use if audio is garbled and you know byte order is wrong)
#   - none: No byte order correction (production default - assumes correct byte order)
# Production: Use 'none' for best performance
# DIAG_EGRESS_SWAP_MODE=none

# Force μ-law output encoding
# Values: true | false
# When to use: Set to 'true' to force μ-law encoding even if detection suggests PCM
# Production: Keep 'false' - let system auto-detect correct encoding
# DIAG_EGRESS_FORCE_MULAW=false

# Attack envelope duration
# Values: Integer (milliseconds), 0 = disabled
# When to use: Add fade-in to prevent audio pops/clicks at segment start
# Production: Keep at 0 (disabled) - can cause initial silence artifacts
# DIAG_ATTACK_MS=0

# Enable audio taps for RCA
# Values: true | false
# NOTE: DIAG_* settings are read from the environment ONLY; YAML streaming.diag_* keys are ignored.
# When to use: Set to 'true' to capture short audio samples before/after processing for analysis
# Impact: Writes WAV files to DIAG_TAP_OUTPUT_DIR for each call
# Permissions: Directory is created with 0700; tap WAV files inherit process umask (typically 0644).
# Note: The directory may not exist until the first call writes taps.
# Production: Keep 'false' - enabling increases disk I/O and storage usage
DIAG_ENABLE_TAPS=false

# Pre-companding tap duration
# Values: Integer (seconds)
# When to use: Increase to capture more audio before companding (useful for codec debugging)
# Production: Not needed when DIAG_ENABLE_TAPS=false
# DIAG_TAP_PRE_SECS=1

# Post-companding tap duration
# Values: Integer (seconds)
# When to use: Increase to capture more audio after companding (useful for quality analysis)
# Production: Not needed when DIAG_ENABLE_TAPS=false
# DIAG_TAP_POST_SECS=1

# Diagnostic audio output directory
# Values: Absolute path
# When to use: Change to a different location if default /tmp fills up
# Production: Not needed when DIAG_ENABLE_TAPS=false
# Permissions: Directory is created with 0700; tap WAV files inherit process umask (typically 0644).
# Note: The directory may not exist until the first call writes taps.
# DIAG_TAP_OUTPUT_DIR=/tmp/ai-engine-taps
