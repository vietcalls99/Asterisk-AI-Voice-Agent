# ═══════════════════════════════════════════════════════════════════════════
# Golden Baseline #2: Deepgram Voice Agent - Enterprise Cloud Agent
# ═══════════════════════════════════════════════════════════════════════════
#
# VALIDATED CONFIGURATION - Production-ready
#
# Requirements:
#   - DEEPGRAM_API_KEY in .env file
#   - OPENAI_API_KEY in .env (for agent's "Think" stage reasoning)
#   - Asterisk 18+ with ARI and AudioSocket modules
#
# Performance:
#   - Response time: <3 seconds (typically 1-2s)
#   - Audio quality: Excellent (Deepgram Aura TTS)
#   - Cost: ~$0.03 per minute (Deepgram pricing)
#
# Best for:
#   - Enterprise deployments requiring high quality
#   - Scenarios needing multi-step reasoning (Think stage)
#   - Cost-sensitive deployments (cheaper than OpenAI Realtime)
#
# For detailed parameter explanations, see: docs/Configuration-Reference.md
# ═══════════════════════════════════════════════════════════════════════════

# Active Configuration - DO NOT CHANGE UNLESS YOU KNOW WHAT YOU'RE DOING
config_version: 4
active_pipeline: local_hybrid  # Don't change - uses provider override via contexts
default_provider: deepgram

# Audio Transport - AudioSocket for Deepgram
audio_transport: audiosocket
audiosocket:
  format: slin
  host: 0.0.0.0
  port: 8090

# Playback Mode
downstream_mode: stream

# Contexts - Use demo_deepgram context to activate Deepgram
contexts:
  default:
    greeting: Hello, how can I help you today?
    profile: telephony_ulaw_8k
    prompt: You are a helpful AI assistant. Be concise and clear.
    provider: deepgram  # Use Deepgram for default context
  demo_deepgram:
    greeting: "Hi! I'm Ava demonstrating Deepgram Voice Agent. Ask me anything about the Asterisk AI Voice Agent project!"
    prompt: "You are Ava (Asterisk Voice Agent) demonstrating Deepgram. Be helpful, conversational, and explain features clearly in 5-10 sentences."
    profile: telephony_ulaw_8k
    provider: deepgram

# Barge-In - Enable for better UX
barge_in:
  enabled: true
  energy_threshold: 700
  initial_protection_ms: 100
  min_ms: 150
  post_tts_end_protection_ms: 100

# VAD Configuration - For utterance detection
vad:
  enhanced_enabled: true
  fallback_buffer_size: 128000
  fallback_enabled: true
  fallback_interval_ms: 4000
  max_utterance_duration_ms: 10000
  min_utterance_duration_ms: 600
  use_provider_vad: false
  utterance_padding_ms: 200
  webrtc_aggressiveness: 1
  webrtc_end_silence_frames: 50
  webrtc_start_frames: 3

# Streaming Configuration
streaming:
  chunk_size_ms: 20
  connection_timeout_ms: 120000
  continuous_stream: true
  empty_backoff_ticks_max: 5
  fallback_timeout_ms: 8000
  greeting_min_start_ms: 40
  jitter_buffer_ms: 950
  keepalive_interval_ms: 5000
  low_watermark_ms: 80
  min_start_ms: 120
  normalizer:
    enabled: true
    max_gain_db: 18.0
    target_rms: 1400
  provider_grace_ms: 500
  sample_rate: 8000

# Audio Profiles - telephony_ulaw_8k is the correct profile for Deepgram
profiles:
  default: telephony_responsive
  telephony_ulaw_8k:
    chunk_ms: auto
    idle_cutoff_ms: 800
    internal_rate_hz: 8000
    provider_pref:
      input_encoding: mulaw
      input_sample_rate_hz: 8000
      output_encoding: mulaw
      output_sample_rate_hz: 8000
    transport_out:
      encoding: slin
      sample_rate_hz: 8000
  telephony_responsive:
    chunk_ms: auto
    idle_cutoff_ms: 600
    internal_rate_hz: 8000
    provider_pref:
      input_encoding: mulaw
      input_sample_rate_hz: 8000
      output_encoding: mulaw
      output_sample_rate_hz: 8000
    transport_out:
      encoding: slin
      sample_rate_hz: 8000

# Provider Configuration - Deepgram Voice Agent
providers:
  deepgram:
    continuous_input: true
    enabled: true
    greeting: Hello, how can I help you today?
    input_encoding: mulaw
    input_sample_rate_hz: 8000
    instructions: Voice assistant. Answer in 5-8 words. Be direct. Expand only if asked.
    model: nova-2-phonecall
    output_encoding: mulaw
    output_sample_rate_hz: 8000
    tts_model: aura-2-thalia-en

# LLM Fallback Configuration
llm:
  initial_greeting: Hello, how can I help you today?
  prompt: Voice assistant. Answer in 5-8 words. Be direct. Expand only if asked.

# Pipelines - Required but not used by monolithic Deepgram provider
pipelines:
  local_hybrid:
    llm: openai_llm
    options:
      llm:
        base_url: https://api.openai.com/v1
        max_tokens: 150
        model: gpt-4o-mini
        temperature: 0.7
      stt:
        chunk_ms: 160
        mode: stt
        stream_format: pcm16_16k
        streaming: true
      tts:
        format:
          encoding: mulaw
          sample_rate: 8000
    stt: local_stt
    tts: local_tts

# Asterisk Configuration
asterisk:
  app_name: asterisk-ai-voice-agent

# ExternalMedia (not used by AudioSocket, but required by config schema)
external_media:
  codec: ulaw
  direction: both
  port_range: 18080:18099
  rtp_host: 0.0.0.0
  rtp_port: 18080
